# 进程与线程

## 进程与线程的区别

官方解释： 进程是资源分配的最小单位，线程是cpu调度的最小单位

做个简单的比喻： 进程=火车，线程=车厢

* 线程在进程下行进（单纯的车厢无法运行）
* 一个进程可以包含多个线程（一辆火车可以有多个车厢）
* 不同进程间数据很难共享（一辆火车伤的乘客很难换到另一辆火车，比如站点换乘）
* 同一进程下不同线程间的数据很容易共享（车厢间交换）
* 进程间不会相互影响，一个线程挂掉将会导致整个进程挂掉（一列火车着火不会影响到另一列火车，但是一列火车上的一节车厢着火，将影响到所有车厢）
* 进程可以拓展到多机，线程最多适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能行进在 不同的轨道上）
* 进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。（比如火车上的洗手间- 互斥锁）
* 进程使用的内存地址可以限定使用量，（比如火车上的餐厅，最多允许多少人进入，如果满了则需要在门口等待，等有人出来了才能进去）；

## 虚拟内存

虚拟内存是操作系统为每个进程提供的一种抽象，每个进程都有属于自己的，私有的，地址连续的虚拟内存，当然我们知道最终进程的数据及代码必然要放到物理内存上，那么必须有某种机制能记住虚拟地址空间中的某个数据被放到了哪个物理内存地址上，这就是所谓的地址空间映射，也就是虚拟内存地址与物理内存地址的映射关系，那么操作系统是如何记住这种映射关系的呢？答案就是页表，页表中记录了虚拟内存地址到物理内存地址的映射关系，有了页表就可以将虚拟地址转换为物理内存地址，这种机制就是虚拟内存。

每个进程都有自己的虚拟地址空间，所有线程共享虚拟地址空间。

## 进程切换和线程切换的区别

进程切换和线程切换的一个最主要区别就在于线程切换设计到虚拟地址空间的切换而进程切换则不会。因为每个进程都有自己的虚拟地址空间，而线程是共享所在进程的虚拟地址空间的，因此同一个进程中的线程切换时不涉及虚拟地址空间的转换。

为什么进程切换要比线程切换慢，因为进程切换设计到虚拟地址空间的切换。


