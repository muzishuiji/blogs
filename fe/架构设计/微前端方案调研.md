## 概述

微前端是一种架构理念，借鉴了微服务的思想，将一个大型的前端微应用拆分成多个独立、自治的子应用，每个子应用可以由不同团队、用不同技术栈独立开发和部署，最终聚合为一个整体产品。

## 主流微前端方案对比

### qiankun

1. 实现原理
基于Single-SPA 扩展路由调度能力，通过动态资源加载和沙箱隔离实现子应用集成。

2. 沙箱机制
    - JS隔离: Proxy代理全局对象（支持多实例），快照沙箱作为降级方案；
    - 样式隔离：动态加载/卸载样式标签，可选Shadow DOM增强；
3. 通信方式

Props数据注入+事件驱动（主从模式），支持全局状态库扩展；

4. 优势&劣势
  - 优势：
    - 开箱即用，社区活跃
    - 强隔离保障多技术栈并行，路由级调度灵活扩展；
  - 劣势：
    - 对Vite支持不佳，需插件且可能存在问题；
    - 沙箱调试难度中等；

### Micro-App
1. 实现原理
基于WebComponents封装<micro-app>标签，通过劫持fetch/xhr重写资源请求，结合DOMh监听实现渲染控制。
2. 沙箱机制
  - JS隔离：Proxy代理子应用Window对象；
  - 样式隔离：Scoped Css选择器限定作用域，支持Shadow DOM模式；
  - 1.x版本支持iframe沙箱模式
3. 通信方式
CustomEvent事件总线 + 标准化API数据传递（props注入与子应用主动触发）

4. 优势&劣势
  - 优势
    - 接入成本低；
    - 对Vite原生支持；
    - 支持可视化工具调试；
  - 劣势
    - JS隔离强度中等；

### 无界
1. 实现原理
利用iframe原生隔离能力，通过DOM代理将子应用内容渲染至主应用容器，消除iframe布局割裂。
2. 沙箱机制
  - JS/CSS隔离：iframe原生上下文隔离；
  - DOM操作：代理iframe子应用DOM事件到主容器，实现无缝嵌入；
3. 通信方式
postMessage 通信 + 事件代理池优化（复用通道降低性能损耗）
4. 优势&劣势
  - 优势：
    - 接入成本低，可实现零改造接入；
    - iframe物理隔离，安全隔离强度高，适用于高安全敏感场景；
    - 对Vite原生支持；
  - 劣势：
    - 调试难度高；
    - 定制灵活性低；

### Single-SPA
1. 实现原理
纯路由级生命周期调度器，无内置沙箱或资源控制能力
2. 沙箱机制
需手动实现Proxy/快照沙箱，或依赖SystemJS动态加载模块；
3. 通信方式
完全自定义（事件总线、全局状态管理库等）
4. 优势&劣势
  - 优势
    - 灵活、强扩展性，适合底层自定义；
  - 劣势
    - 接入成本高；
    - 无内置沙箱和资源控制能力，沙箱逃逸风向高；
    - 对Vite支持需依赖插件；

### Module Federation（Webpack）
1. 实现原理
构建时声明Remote/Host模块依赖关系，运行时动态加载共享代码。
2. 沙箱机制
无隔离限制，依赖版本控制和接口约定避免冲突；
3. 通信方式
模块直接调用，需严格控制版本兼容性
4. 优势&劣势
  - 优势：
    - 构建时共享模块，减少重复代码；
    - 调试链路段（源码级调试）；
    - 通信效率高（直接调用）；
  - 劣势：
    - 接入成本高；
    - 无沙箱隔离机制，沙箱逃逸风险高；
    - 对Vite支持社区插件

## 微前端的优势与挑战

1. 优势
  - 技术栈无强依赖：子应用可以自由选择技术栈（Vue、React、Angular）；
  - 独立开发部署：每个子应用可由独立团队负责，独立CI/CD发布；
  - 降低复杂度：将复杂单体应用拆解为多个职责清晰的小模块；
  - 增量升级：逐步替换老旧系统，适用于前端重构、技术栈升级；
  - 性能优化空间大：可按需加载子应用资源，实现更快首屏加载；

2. 挑战
  - 子应用通信：主应用与子应用间需要全局事件总线（如CustomEvent、PostMessage）；
  - 样式隔离：避免子应用样式污染主应用（使用Css Module、Shadow DOM、Scoped-Css）；
  - 依赖重复加载：各子应用可能重复加载Vue/React导致包体积增大；
  - 路由冲突：多应用使用不同框架路由系统，需主应用统一协调；
  - 性能优化：应避免每次切换子应用都重新加载，缓存子应用；

## 总结和选型

2025年微前端技术路线呈现双极化发展：
1. 模块共享派：以Module Federation为核心，追求构建时优化与开发体验，适合模块化程度高的新系统；
2. 运行时隔离派：qiankun/micro-app/无界 通过沙箱或iframe实现安全隔离，保障复杂场景稳定性；

选型时应该锚定核心诉求优先级：
- 安全隔离 > 开发效率：选择无界或qinakun + Shadow DOM；
- 开发体验 > 历史包袱：采用Module Federation构建模块生态；
- 渐进式改造：micro-app 提供Vite零改造与沙箱平衡方案；

未来框架将更深度集成构建工具链，模糊微前端与模块化的边界，形成「编译时协同（方便调试，开发效率高）+运行时隔离（安全隔离，保障稳定性）」的融合架构；
